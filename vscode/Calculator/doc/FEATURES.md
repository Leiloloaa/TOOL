# 功能特性详细说明

## 当前版本功能 (v1.2.0)

### 核心功能
1. **输入触发弹框**
   - 输入数学表达式时自动检测
   - 100ms延迟后弹出计算弹框
   - 支持防抖机制，避免频繁弹框

2. **弹框显示**
   - 显示格式：`表达式 = 结果`
   - 简洁的界面设计
   - 支持回车键替换操作

3. **一键替换**
   - 按回车键将表达式替换为结果
   - 防重复触发机制
   - 替换后不会再次弹框

4. **状态栏集成**
   - 实时显示当前计算结果
   - 替换操作状态提示
   - 简洁的状态信息

### 计算能力
1. **基本运算符**
   - 加法：`+`
   - 减法：`-`
   - 乘法：`*`
   - 除法：`/`

2. **复杂表达式**
   - 多步连续计算：`1+2+3`
   - 混合运算：`1+2*3`
   - 运算符优先级：先乘除，后加减

3. **精度控制**
   - 保留两位小数
   - 自动四舍五入
   - 错误处理（除零检测）

### 用户体验
1. **简洁设计**
   - 屏蔽了悬停触发功能
   - 屏蔽了内联点击提示
   - 屏蔽了复制功能
   - 专注于核心计算和替换功能

2. **快速响应**
   - 100ms弹框延迟
   - 防抖机制优化
   - 流畅的交互体验

3. **防重复触发**
   - 替换标志位管理
   - 数字替换检测
   - 1000ms保护时间

## 已屏蔽的功能（历史版本功能）

### v1.2.0 屏蔽的功能
以下功能在v1.2.0版本中被屏蔽，但代码中保留，可根据需要重新启用：

#### 1. 悬停触发功能
- **功能描述**：鼠标悬停在数学表达式上时显示计算结果
- **屏蔽位置**：`provideHover`方法返回null
- **重新启用**：取消`provideHover`方法中的注释，恢复悬停检测逻辑

#### 2. 内联显示功能
- **功能描述**：表达式后面显示`= 结果 (点击替换)`
- **屏蔽位置**：`updateCodeLenses`方法调用被注释
- **重新启用**：取消`onDocumentChange`中的注释

#### 3. 点击替换功能
- **功能描述**：点击内联按钮或弹框选项替换表达式
- **屏蔽位置**：QuickPick选择事件被简化，只关闭弹框
- **重新启用**：恢复`onDidChangeSelection`中的替换逻辑

#### 4. 复制功能
- **功能描述**：复制计算结果到剪贴板
- **屏蔽位置**：复制相关代码已完全移除
- **重新启用**：需要重新添加复制相关代码

### 屏蔽原因
- **简化用户界面**：减少功能选项，降低用户学习成本
- **减少功能冲突**：避免多种触发方式造成的混乱
- **提升核心体验**：专注于输入触发和回车替换的核心功能
- **优化性能**：减少不必要的事件监听和处理

### 重新启用指南
如需重新启用某个功能，可以：
1. 查看代码中的注释标记
2. 取消相关代码的注释
3. 恢复相关的事件处理逻辑
4. 重新编译和测试功能

## 技术架构

### 核心组件
1. **CalculatorProvider 类**
   - 实现主要计算逻辑
   - 管理弹框显示
   - 处理用户交互

2. **事件监听器**
   - `onDocumentChange`：监听文档变化
   - `onKeyPress`：处理回车键事件
   - 防抖机制优化

3. **计算引擎**
   - 表达式解析器
   - 运算符优先级处理
   - 精度控制算法

### 性能优化
1. **防抖机制**
   - 100ms延迟触发
   - 避免频繁计算
   - 提升响应性能

2. **内存管理**
   - 及时清理定时器
   - 防止内存泄漏
   - 优化对象生命周期

3. **错误处理**
   - 除零检测
   - 异常捕获
   - 优雅降级

## 使用场景

### 适用场景
1. **代码注释中的计算**
   ```javascript
   // 计算总价：10 * 1.2 + 5  // 弹框显示：17
   ```

2. **配置文件中的数值**
   ```json
   {
     "timeout": 30 * 1000,  // 弹框显示：30000
     "retries": 3 + 2       // 弹框显示：5
   }
   ```

3. **文档中的数学计算**
   ```markdown
   ## 性能指标
   - 响应时间：100 + 50ms  // 弹框显示：150
   - 并发数：10 * 2        // 弹框显示：20
   ```

### 不适用场景
1. 复杂的数学函数计算
2. 变量和常量的使用
3. 历史计算记录需求
4. 批量计算处理

## 未来规划

### 短期目标
- 🔧 优化弹框样式
- 🔧 增加更多运算符支持
- 🔧 改进错误提示

### 长期目标
- 🚀 支持数学函数（sin、cos、sqrt等）
- 🚀 支持变量和常量
- 🚀 支持历史计算记录
- 🚀 支持自定义快捷键
- 🚀 支持多语言界面
