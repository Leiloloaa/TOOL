# 文件夹监听工具

## 功能描述

文件夹监听工具是一个自动化的图片处理工具，可以监听指定文件夹的变化，当检测到新增的图片文件时，自动调用图片压缩功能进行处理。

## 主要特性

- **实时监听**: 使用 Node.js 原生 `fs.watch` API 监听文件夹变化
- **自动压缩**: 检测到图片文件时自动调用压缩功能
- **智能过滤**: 只处理图片文件（PNG、JPG、JPEG、GIF、BMP、WebP）
- **防重复处理**: 避免重复处理同一个文件
- **队列处理**: 支持多个文件同时处理，避免冲突
- **状态显示**: 实时显示监听状态和处理进度
- **错误处理**: 完善的错误处理和日志记录

## 使用方法

1. **选择文件夹**: 点击"选择监听文件夹"按钮选择要监听的文件夹
2. **设置命名模式**: 
   - 保持原文件名：压缩后的文件保持原文件名
   - 自定义前缀：为压缩后的文件添加自定义前缀
3. **开始监听**: 点击"开始监听"按钮启动监听
4. **监控状态**: 查看监听状态和实时日志
5. **停止监听**: 点击"停止监听"按钮停止监听

## 技术实现

### 核心组件

- **FolderWatcher 类**: 负责文件夹监听和文件处理
- **文件稳定性检测**: 等待文件写入完成后再处理
- **处理队列**: 管理多个文件的处理顺序
- **IPC 通信**: 主进程与渲染进程的通信

### 监听机制

使用 Node.js 原生的 `fs.watch` API：

```javascript
fs.watch(folderPath, { 
  recursive: true,
  persistent: true 
}, (eventType, fileName) => {
  // 处理文件变化
});
```

### 文件处理流程

1. 检测文件变化
2. 过滤图片文件
3. 等待文件写入稳定
4. 创建临时目录
5. 调用图片压缩功能
6. 替换原文件
7. 清理临时文件

## 注意事项

- 只监听指定文件夹内的直接变化，不递归监听子文件夹
- 忽略隐藏文件（以 . 开头的文件）
- 处理过程中会创建临时目录，处理完成后自动清理
- 支持的文件格式：PNG、JPG、JPEG、GIF、BMP、WebP
- 建议在稳定的网络环境下使用，避免文件传输中断

## 错误处理

- 文件不存在：自动跳过
- 文件读取错误：记录错误日志
- 压缩失败：记录错误信息，不影响其他文件处理
- 监听器错误：自动停止监听并显示错误信息

## 性能优化

- 使用文件大小检测确保文件写入完成
- 队列处理避免并发冲突
- 防重复处理机制
- 超时保护机制
