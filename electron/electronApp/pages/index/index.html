<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ› ï¸å‰ç«¯å·¥å…·</title>
    <link rel="stylesheet" href="../shared/nav.css" />
    <link rel="stylesheet" href="../shared/sidebar-adapter.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
        overflow-x: hidden;
      }

      /* éšè—æ»šåŠ¨æ¡ä½†ä¿æŒæ»šåŠ¨åŠŸèƒ½ */
      body::-webkit-scrollbar {
        width: 0;
        background: transparent;
      }

      body::-webkit-scrollbar-track {
        background: transparent;
      }

      body::-webkit-scrollbar-thumb {
        background: transparent;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 0 10px 20px 10px !important;
        min-height: 100vh;
        overflow-x: hidden;
      }

      #nav-container {
        margin-bottom: 20px;
      }

      .main-content {
        background: white;
        border-radius: 25px;
        padding: 40px;
        padding-top: 10px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow-x: hidden;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        padding-top: 20px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
      }

      .header h1 {
        font-size: 2rem;
        color: #333;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .header p {
        font-size: 1.1rem;
        color: #666;
        font-weight: 400;
      }

      .features-section {
        margin-bottom: 20px;
      }

      .features-section h2 {
        font-size: 1.5rem;
        color: #4f4f6b;
        margin-bottom: 15px;
        text-align: center;
        font-weight: 700;
      }

      .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .feature-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 10px;
        padding: 15px;
        border: 1px solid #e9ecef;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .feature-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .feature-icon {
        font-size: 2rem;
        margin-bottom: 12px;
        display: block;
      }

      .feature-card h3 {
        font-size: 1.1rem;
        color: #333;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .feature-card p {
        color: #666;
        line-height: 1.5;
        font-size: 0.9rem;
      }

      .links-section {
        margin-top: 15px;
        margin-bottom: 25px;
      }

      .links-section h2 {
        font-size: 1.6rem;
        color: #4f4f6b;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 700;
      }

      .links-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
      }

      .link-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 12px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .link-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(102, 126, 234, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .link-card:hover::before {
        left: 100%;
      }

      .link-card:hover {
        border-color: #667eea;
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
      }

      .link-icon {
        font-size: 1.3rem;
        margin-bottom: 8px;
        display: block;
        color: #667eea;
      }

      .link-card h3 {
        font-size: 0.9rem;
        color: #333;
        margin-bottom: 5px;
        font-weight: 600;
      }

      .link-card p {
        color: #666;
        font-size: 0.75rem;
        line-height: 1.2;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
        font-size: 1.1rem;
      }

      .error {
        text-align: center;
        padding: 40px;
        color: #dc3545;
        font-size: 1.1rem;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .main-content {
          padding: 20px;
        }

        .header h1 {
          font-size: 1.8rem;
        }

        .header p {
          font-size: 1rem;
        }

        .features-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .links-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 12px;
        }

        .feature-card,
        .link-card {
          padding: 15px;
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: 10px;
        }

        .main-content {
          padding: 15px;
        }

        .header h1 {
          font-size: 1.6rem;
        }

        .links-grid {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .feature-card,
        .link-card {
          padding: 12px;
        }
      }

      /* å¯¼èˆªæœç´¢ç›¸å…³æ ·å¼ */
      .nav-link.hidden {
        opacity: 0 !important;
        transform: translateX(-20px) !important;
        pointer-events: none !important;
        height: 0 !important;
        padding: 0 20px !important;
        margin: 0 16px !important;
        overflow: hidden !important;
        display: none !important;
      }

      .nav-search-clear {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 12px;
        opacity: 0.8;
        cursor: pointer;
        padding: 2px;
        border-radius: 3px;
        transition: all 0.2s ease;
        z-index: 10;
      }

      .nav-search-clear:hover {
        opacity: 1;
        background: rgba(255, 255, 255, 0.2);
      }

      /* è°ƒæ•´æœç´¢å›¾æ ‡ä½ç½®ï¼Œé¿å…ä¸æ¸…é™¤æŒ‰é’®é‡å  */
      .nav-search-icon {
        position: absolute;
        right: 18px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 14px;
        opacity: 0.7;
        pointer-events: none;
      }

      /* å½“æœ‰æ¸…é™¤æŒ‰é’®æ—¶ï¼Œéšè—æœç´¢å›¾æ ‡ */
      .nav-search-container:has(.nav-search-clear[style*="display: block"])
        .nav-search-icon {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- å¯¼èˆªèœå• -->
      <div id="nav-container"></div>

      <div class="main-content">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="header">
          <h1>æ´»åŠ¨å¼€å‘å·¥å…·é›†</h1>
          <p>æä¾›æ´»åŠ¨ç®¡ç†ã€é“¾æ¥è·³è½¬ã€æ–‡æ¡£æŸ¥çœ‹ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚</p>
        </div>

        <!-- é“¾æ¥åŒºåŸŸ -->
        <div class="links-section">
          <div id="links-container" class="links-grid">
            <div class="loading">æ­£åœ¨åŠ è½½é“¾æ¥...</div>
          </div>
        </div>

        <!-- åŠŸèƒ½ä»‹ç»åŒºåŸŸ -->
        <div class="features-section">
          <h2>âœ¨ æ ¸å¿ƒåŠŸèƒ½</h2>
          <div class="features-grid">
            <div class="feature-card">
              <span class="feature-icon">ğŸ“Š</span>
              <h3>æ´»åŠ¨é“¾æ¥ç®¡ç†</h3>
              <p>
                ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ´»åŠ¨é“¾æ¥ï¼Œæ”¯æŒå¤šç¯å¢ƒåˆ‡æ¢ã€å¿«é€Ÿè·³è½¬ï¼Œå®æ—¶æŸ¥çœ‹æ´»åŠ¨çŠ¶æ€å’Œæ’æœŸä¿¡æ¯ã€‚
              </p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">ğŸ¯</span>
              <h3>æ™ºèƒ½æœç´¢</h3>
              <p>
                å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œæ”¯æŒæŒ‰æ´»åŠ¨åç§°ã€IDã€é“¾æ¥ç­‰å…³é”®è¯å¿«é€Ÿå®šä½ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚
              </p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">ğŸ“</span>
              <h3>æ–‡æ¡£ä¸­å¿ƒ</h3>
              <p>
                é›†ä¸­ç®¡ç†éœ€æ±‚æ–‡æ¡£ã€è®¾è®¡ç¨¿ã€æ–‡æ¡ˆç­‰èµ„æºï¼Œä¸€é”®è·³è½¬åˆ°ç›¸å…³æ–‡æ¡£ï¼Œä¿æŒä¿¡æ¯åŒæ­¥ã€‚
              </p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">âš¡</span>
              <h3>å¿«é€Ÿåˆ›å»º</h3>
              <p>
                è‡ªåŠ¨åŒ–æ´»åŠ¨åˆ›å»ºæµç¨‹ï¼Œæ”¯æŒGitåˆ†æ”¯ç®¡ç†ã€æ–‡ä»¶ç”Ÿæˆï¼Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡ã€‚
              </p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">ğŸ”§</span>
              <h3>å¼€å‘å·¥å…·</h3>
              <p>
                é›†æˆJenkinsæ„å»ºã€OSSç®¡ç†ã€ç¯å¢ƒåˆ‡æ¢ç­‰å¼€å‘å¿…å¤‡å·¥å…·ï¼Œä¸€ç«™å¼è§£å†³å¼€å‘éœ€æ±‚ã€‚
              </p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">ğŸ“ˆ</span>
              <h3>é¡¹ç›®ç®¡ç†</h3>
              <p>
                æ”¯æŒå¤šé¡¹ç›®ç®¡ç†ï¼ŒåŒ…æ‹¬Yohoã€Hiyooã€SoulStarç­‰ï¼Œç»Ÿä¸€çš„å·¥ä½œæµç¨‹å’Œæ ‡å‡†ã€‚
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // å¯¼èˆªæœç´¢åŠŸèƒ½
      let searchTimeout;

      function performSearch(searchTerm) {
        const links = Array.from(document.querySelectorAll(".nav-link"));
        const noResults = document.querySelector(".no-results");
        let visibleCount = 0;

        links.forEach((link, index) => {
          const keywords = link.getAttribute("data-keywords") || "";
          const text = link.querySelector(".nav-text").textContent;
          const desc = link.querySelector(".nav-desc").textContent;

          const searchText = `${keywords} ${text} ${desc}`.toLowerCase();
          const isMatch =
            searchTerm === "" || searchText.includes(searchTerm.toLowerCase());

          if (isMatch) {
            link.classList.remove("hidden");
            visibleCount++;
          } else {
            link.classList.add("hidden");
          }
        });

        // æ˜¾ç¤º/éšè—æ— ç»“æœæç¤º
        if (visibleCount === 0 && searchTerm !== "") {
          if (noResults) {
            noResults.style.display = "block";
          }
        } else {
          if (noResults) {
            noResults.style.display = "none";
          }
        }

        // æ›´æ–°æœç´¢æ¡†çš„è§†è§‰åé¦ˆ
        const searchInput = document.getElementById("navSearchInput");
        const clearBtn = document.getElementById("navSearchClear");
        const searchIcon = document.querySelector(".nav-search-icon");

        if (searchInput) {
          if (searchTerm !== "") {
            searchInput.style.background =
              visibleCount > 0
                ? "rgba(255, 255, 255, 0.25)"
                : "rgba(255, 255, 255, 0.15)";
          } else {
            searchInput.style.background = "rgba(255, 255, 255, 0.15)";
          }
        }

        // æ˜¾ç¤º/éšè—æ¸…é™¤æŒ‰é’®å’Œæœç´¢å›¾æ ‡
        if (clearBtn) {
          clearBtn.style.display = searchTerm !== "" ? "block" : "none";
        }

        if (searchIcon) {
          searchIcon.style.display = searchTerm !== "" ? "none" : "block";
        }
      }

      function initSearch() {
        const searchInput = document.getElementById("navSearchInput");
        if (!searchInput) {
          console.warn("æœªæ‰¾åˆ°å¯¼èˆªæœç´¢è¾“å…¥æ¡†");
          return;
        }

        console.log("åˆå§‹åŒ–å¯¼èˆªæœç´¢åŠŸèƒ½");

        searchInput.addEventListener("input", function () {
          clearTimeout(searchTimeout);
          const searchTerm = this.value.trim();

          searchTimeout = setTimeout(() => {
            performSearch(searchTerm);
          }, 300);
        });

        // æ¸…ç©ºæœç´¢æ—¶æ¢å¤æ‰€æœ‰èœå•é¡¹
        searchInput.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            this.value = "";
            performSearch("");
            this.blur();
          }
        });

        // æ·»åŠ ç„¦ç‚¹äº‹ä»¶
        searchInput.addEventListener("focus", function () {
          this.placeholder = "è¾“å…¥å…³é”®è¯æœç´¢...";
        });

        searchInput.addEventListener("blur", function () {
          this.placeholder = "æœç´¢...";
        });

        // æ¸…é™¤æœç´¢æŒ‰é’®
        const clearBtn = document.getElementById("navSearchClear");
        if (clearBtn) {
          clearBtn.addEventListener("click", function () {
            searchInput.value = "";
            performSearch("");
            searchInput.focus();
          });
        }

        // åˆå§‹æœç´¢ï¼ˆæ¸…ç©ºçŠ¶æ€ï¼‰
        performSearch("");
      }

      // åŠ è½½å¯¼èˆªèœå•
      async function loadNavigation() {
        try {
          const result = await window.electronAPI.loadNavigation("index");
          if (result.success) {
            // æ³¨å…¥CSSæ ·å¼
            const style = document.createElement("style");
            style.textContent = result.css;
            document.head.appendChild(style);

            // æ³¨å…¥HTMLå†…å®¹
            document.getElementById("nav-container").innerHTML = result.html;

            // å¯¼èˆªåŠ è½½å®Œæˆååˆå§‹åŒ–æœç´¢åŠŸèƒ½
            setTimeout(() => {
              initSearch();
            }, 100);
          }
        } catch (error) {
          console.error("Failed to load navigation:", error);
        }
      }

      // è·å–é“¾æ¥å›¾æ ‡
      function getLinkIcon(label) {
        const iconMap = {
          é£ä¹¦ç»Ÿä¸€ç™»å½•: "ğŸ”",
          æ´»åŠ¨æ’æœŸè¡¨: "ğŸ“…",
          yohoå…«æœˆéœ€æ±‚æ–‡æ¡£: "ğŸ“‹",
          hiyooå…«æœˆéœ€æ±‚æ–‡æ¡£: "ğŸ“‹",
          yohoæœˆè®¡åˆ’å®‰æ’è¡¨: "ğŸ“Š",
          hiyooæœˆè®¡åˆ’å®‰æ’è¡¨: "ğŸ“Š",
          soulStaræ´»åŠ¨æ’æœŸè¡¨: "â­",
          dreamBitæ´»åŠ¨æ’æœŸè¡¨: "ğŸ’",
          è®¾è®¡æœˆè®¡åˆ’: "ğŸ¨",
          å‰åç«¯æ¨¡å—: "ğŸ”§",
          å‰ç«¯å›ºå®šæ–‡æ¡ˆ: "ğŸ“",
        };

        return iconMap[label] || "ğŸ”—";
      }

      // æ¸²æŸ“é“¾æ¥
      function renderLinks(links) {
        const container = document.getElementById("links-container");

        if (!links || links.length === 0) {
          container.innerHTML = '<div class="error">æš‚æ— é“¾æ¥æ•°æ®</div>';
          return;
        }

        const linksHTML = links
          .map(
            (link) => `
        <div class="link-card" onclick="openLink('${link.url}')">
          <span class="link-icon">${getLinkIcon(link.label)}</span>
          <h3>${link.label}</h3>
          <p>ç‚¹å‡»è·³è½¬åˆ°ç›¸å…³é¡µé¢</p>
        </div>
      `
          )
          .join("");

        container.innerHTML = linksHTML;
      }

      // æ‰“å¼€é“¾æ¥
      function openLink(url) {
        if (url) {
          window.open(url, "_blank");
        }
      }

      // åŠ è½½é…ç½®
      async function loadConfig() {
        try {
          const response = await fetch("./config.json");
          if (!response.ok) {
            throw new Error("Failed to load config");
          }

          const config = await response.json();
          if (config.links && Array.isArray(config.links)) {
            renderLinks(config.links);
          } else {
            document.getElementById("links-container").innerHTML =
              '<div class="error">é…ç½®æ ¼å¼é”™è¯¯</div>';
          }
        } catch (error) {
          console.error("Error loading config:", error);
          document.getElementById("links-container").innerHTML =
            '<div class="error">åŠ è½½é…ç½®å¤±è´¥: ' + error.message + "</div>";
        }
      }

      // å…¨å±€æµ‹è¯•å‡½æ•°
      window.testNavSearch = function (term) {
        console.log("æ‰‹åŠ¨æµ‹è¯•æœç´¢:", term);
        performSearch(term);
      };

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", () => {
        loadNavigation();
        loadConfig();
      });
    </script>
  </body>
</html>
